# 项目特定要求

## 关于Sect项目

Sect项目是一个基于Kotlin Multiplatform的游戏开发项目，采用ECS（实体组件系统）架构。本文档包含项目特定的要求和规范。

## 架构要求

### ECS架构

- 严格遵循ECS架构原则：
  - 实体（Entity）：唯一标识符
  - 组件（Component）：纯数据容器
  - 系统（System）：纯逻辑处理
  - 原型（Archetype）：相同组件组合的实体集合

- 系统分类：
  - 核心系统：处理基础ECS功能
  - 游戏系统：处理游戏特定逻辑（如TimeSystem、MovementSystem）
  - 扩展系统：提供可选的扩展功能

### 模块结构

- **lko-core**：核心工具和通用功能
- **lko-di**：依赖注入系统
- **lko-ecs**：ECS核心实现

## 编码规范

### 包命名

- 所有包名必须以`cn.jzl`开头
- ECS相关代码必须放在`cn.jzl.ecs`包下
- 游戏特定代码必须放在`cn.jzl.ecs.game`或其子包下

### 组件规范

- 所有组件必须使用`@Serializable`注解
- 组件必须是数据类
- 组件名称应清晰描述其功能，如`Position`、`Velocity`、`Health`
- 避免创建过大的组件，应将功能拆分为多个小型组件

### 系统规范

- 所有系统必须实现`WorldOwner`接口
- 系统类名应以`System`结尾，如`TimeSystem`、`MovementSystem`
- 系统应提供`update`方法，接收`deltaTime`参数
- 系统应专注于单一功能，遵循单一职责原则

### 实体管理

- 实体ID必须是唯一的
- 实体创建和销毁必须通过`World`类进行
- 避免直接访问实体内部数据

## 序列化要求

- 所有游戏数据必须支持序列化和反序列化
- 使用`kotlinx.serialization`库进行序列化
- 序列化格式使用JSON

## 测试要求

- 所有公共API必须有对应的单元测试
- 测试类必须与被测试类放在相同的包结构下
- 测试方法必须使用描述性命名
- 测试必须覆盖正常和异常情况

## 性能要求

### 帧率目标

- 目标帧率：20 FPS（通过`TICKS_PER_SECOND`常量控制）
- 允许在复杂场景下短暂下降，但平均帧率不应低于15 FPS

### 内存管理

- 避免内存泄漏
- 重用对象而非频繁创建新对象
- 使用对象池管理频繁创建的对象
- 定期清理不再使用的实体和组件

### 代码优化

- 避免在热路径中创建对象
- 使用内联函数减少函数调用开销
- 优化循环和条件判断
- 合理使用协程，避免过度使用

## 构建要求

### 构建系统

- 使用Gradle构建项目
- 支持多平台构建（JVM、JS等）

### 依赖管理

- 所有依赖必须在根目录的`build.gradle.kts`中声明
- 避免使用不稳定版本的依赖
- 定期更新依赖到最新稳定版本

## 部署要求

- 支持多种部署方式
- 提供清晰的部署文档
- 支持开发、测试和生产环境配置

## 版本控制

### Git规范

- 提交信息必须清晰描述更改内容
- 提交信息格式：`[类型] 描述`
  - 类型：feat（新功能）、fix（修复）、docs（文档）、style（样式）、refactor（重构）、test（测试）、chore（构建/工具）

- 示例：`feat: 添加TimeSystem时间管理系统`

- 分支命名规范：
  - 功能分支：`feature/功能名称`
  - 修复分支：`fix/问题描述`
  - 开发分支：`develop`
  - 主分支：`main`

## 文档要求

- 所有公共API必须有KDoc文档
- 文档必须清晰描述功能、参数和返回值
- 文档必须使用中文

## 代码审查要求

- 所有代码必须经过审查才能合并到主分支
- 审查重点：
  - 代码质量
  - 性能影响
  - 安全性
  - 可维护性
  - 测试覆盖

## 项目特有模式

### 时间管理

- 使用`TimeSystem`统一管理游戏时间
- 支持游戏速度调节
- 支持暂停/恢复功能
- 时间单位转换：
  - `TICKS_PER_SECOND`：每秒帧数
  - `SECONDS_PER_MINUTE`：每分钟秒数
  - `MINUTES_PER_HOUR`：每小时分钟数
  - `HOURS_PER_DAY`：每天小时数
  - `DAYS_PER_MONTH`：每月天数
  - `MONTHS_PER_YEAR`：每年月数

### 季节系统

- 一年分为4个季节：春季（1-3月）、夏季（4-6月）、秋季（7-9月）、冬季（10-12月）
- 季节变化影响游戏内的各种机制

### 修真主题

- 游戏基于修真主题，包含角色成长、资源收集、战斗等元素
- 代码中应体现修真主题的命名和设计

## 扩展机制

- 支持通过`addon`包扩展ECS功能
- 扩展应遵循项目的编码规范
- 扩展不应破坏核心功能

## 故障处理

- 系统应具备容错能力
- 关键错误必须记录日志
- 避免程序崩溃
- 提供错误恢复机制

## 开发流程

1. 需求分析和设计
2. 编写代码和测试
3. 代码审查
4. 合并到开发分支
5. 集成测试
6. 发布到主分支

## 工具和环境

### 开发环境

- IDE：IntelliJ IDEA
- Kotlin版本：最新稳定版
- JDK版本：11或以上

### 开发工具

- 使用Git进行版本控制
- 使用Gradle进行构建
- 使用kotlinx.serialization进行序列化

## 结论

遵循这些项目特定要求将有助于保持代码质量、可维护性和性能，确保Sect项目的成功开发和长期维护。