# 宗门修真录 - 核心玩法设计文档

> 本文档记录游戏核心玩法的设计决策，包括 AI 角色系统、门派任务和交易所系统。

---

## 1. AI 角色系统

### 1.1 决策方式

**目标导向 (GOAP)**

AI 角色根据目标进行规划，选择最优行动序列来实现目标。

### 1.2 目标来源

| 来源 | 优先级 | 说明 |
|------|--------|------|
| 自主目标 | 高 | AI 根据自身需求（修炼、吃饭、社交）主动设定 |
| 门派任务 | 低 | 玩家发布的任务，弟子可选择接受 |

### 1.3 差异化机制

#### 性格参数

每个弟子都有独立的性格参数，范围 -1 到 1，表示正负倾向。

```kotlin
data class Personality(
    val diligence: Float = 0f,       // 勤奋: 1=极其勤奋, -1=极其懒惰
    val cautious: Float = 0f,       // 谨慎: 1=极其谨慎, -1=极其冒险
    val greed: Float = 0f,          // 贪婪: 1=极其贪婪, -1=极其慷慨
    val loyalty: Float = 0f,         // 忠诚: 1=极其忠诚, -1=极其背叛
    val ambition: Float = 0f,       // 野心: 1=极其有野心, -1=极其淡泊
    val sociability: Float = 0f,    // 合群: 1=极其合群, -1=极其孤僻
    val morality: Float = 0f,       // 道德: 1=极其正直, -1=极其邪恶
    val patience: Float = 0f,       // 耐心: 1=极其耐心, -1=极其急躁
)
```

#### 性格生成

| 来源 | 说明 |
|------|------|
| 初始值 | 随机生成，范围 -0.5 到 0.5 |
| 渐变 | 长期行为累计影响性格 |
| 突变 | 重大事件、境界提升、随机事件导致性格剧变 |

##### 性格渐变

- 长期行为累计影响性格
- 例如：长期做危险任务的弟子，冒险倾向会增加

##### 性格突变

- 重大事件（突破失败、走火入魔）
- 境界提升时
- 随机奇遇事件

#### 性格对决策的影响

1. **目标权重** - 选择任务时，性格影响各目标的权重
2. **行为微调** - 同样目标，不同性格有不同的执行方式

#### 擅长领域

| 维度 | 说明 |
|------|------|
| 经验值 | 每完成一次某类任务，经验+1 |
| 难度加成 | 难度越高的任务，经验越多 |
| 影响 | 经验越高，越倾向选择该类型任务 |

#### 经历影响

| 维度 | 说明 |
|------|------|
| 成功/失败记忆 | 完成任务的成功/失败经历影响后续选择 |
| 情感关系 | 与其他弟子的关系影响互动 |
| 擅长领域 | 某类任务经验值越高，越倾向选择 |

---

## 2. 门派任务

### 2.1 任务类型

| 类型 | 说明 | 示例 |
|------|------|------|
| 资源任务 | 采集、炼丹、炼器 | 采集灵草、炼制丹药 |
| 修炼任务 | 闭关、论道，切磋 | 与同门论道 |
| 外交任务 | 探访其他宗门 | 外出交流 |
| 建设任务 | 建造，维护设施 | 修缮殿堂 |

### 2.2 任务流程

```
掌门发布 → 弟子查看 → 主动接受 → 执行任务 → 提交奖励
```

### 2.3 任务发布

| 来源 | 说明 |
|------|------|
| 掌门手动发布 | 掌门/长老手动发布 |
| 库存自动检测 | 库存低于阈值自动发布 |
| 弟子求购 | 弟子发布自己的需求任务 |

### 2.4 任务难度

- **分级**：1-5星
- **奖励加成**：星级提供额外奖励加成

### 2.5 任务奖励

| 计算方式 | 说明 |
|----------|------|
| 基础奖励 | 由物品价值和目标难度决定 |
| 星级加成 | 每星 +20% 奖励 |

| 奖励类型 | 说明 |
|----------|------|
| 贡献点 | 门派贡献，可兑换资源 |
| 灵石 | 游戏货币 |
| 物品 | 随机物品奖励 |

### 2.6 任务接取

- **接取方式**：弟子主动查看并选择接受任务

### 2.7 任务取消

- **可以取消**
- **惩罚**：扣除贡献点

### 2.8 任务失败

- **惩罚**：扣除贡献点

### 2.9 任务刷新

- **定时刷新**：固定任务定时刷新
- **动态添加**：门派需求、弟子需求可以添加新任务

---

## 3. 交易所系统

### 3.1 交易模式

**寄卖模式** - 弟子通过交易所挂单，不直接交易

### 3.2 寄卖流程

```
弟子挂单 → 设置物品和价格 → 系统给出参考价 → 弟子调整价格 → 上架等待 → 被购买
```

| 特性 | 说明 |
|------|------|
| 定价 | 系统参考价 + 市场波动 + 弟子可调整 |
| 交易 | 实时完成 |
| 调整范围 | 可在参考价一定范围内调整 |

### 3.3 搜购流程

```
弟子搜购 → 设置物品和价位 → 系统匹配 → 购买成功
```

| 特性 | 说明 |
|------|------|
| 匹配规则 | 价格优先，价格相同则时间优先 |
| 等待 | 需要等待卖家上架 |

### 3.4 定价机制

| 机制 | 说明 |
|------|------|
| 系统参考价 | 根据物品基础价值给出参考价格 |
| 市场波动 | 根据供需关系动态调整 |
| 弟子调整 | 可在参考价一定范围内调整 |

### 3.5 税率

| 设定 | 说明 |
|------|------|
| 范围 | 0-20% |
| 调整者 | 掌门 |
| 收入归属 | 门派收入 |

### 3.6 支持物品

| 类型 | 示例 |
|------|------|
| 装备 | 武器，防具 |
| 材料 | 炼丹、炼器材料 |
| 功法 | 功法秘籍 |
| 丹药 | 炼制的丹药 |

---

## 4. 经济系统

### 4.1 闭环设计

所有物品都不会无故产生或消失

### 4.2 物品产出

| 来源 | 说明 |
|------|------|
| 采集 | 弟子去采集药材、矿物 |
| 炼制 | 炼丹、炼器产出 |
| 种植 | 药园种植产出 |
| 击杀 | 外出历练获得 |

---

## 5. 待细化内容

以下内容在当前版本中暂不讨论，留待后续迭代：

1. **学习系统** - AI 从经验中学习，第一版暂不做
2. **交流系统** - 弟子之间的日常对话、关系建立
3. **传承系统** - 功法、技艺的师徒传承、遗产继承
4. **外交任务** - 探访其他宗门

---

## 6. 文档变更记录

| 日期 | 变更说明 |
|------|----------|
| 2026-02-16 | 初始版本，记录 AI 角色系统、门派任务、交易所系统设计 |
| 2026-02-16 | 细化性格参数（8维度，范围-1到1）、门派任务细节（难度星级、取消惩罚、刷新机制）、交易所细节（税率、市场波动） |
