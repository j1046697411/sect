---
name: requirement-chat
description: 当用户想聊需求、设计、想法时使用此技能。触发场景：(1) "聊聊"/"讨论一下"/"帮我梳理"，(2) 需求分析/设计讨论，(3) 澄清模糊想法，(4) 需求评审/拆分/可行性分析，(5) 游戏设计讨论。聊天结束后自动记录有价值内容到记忆库。
---

# 需求聊谈（含记忆库集成）

## 核心理念

**引导式选择 > 开放式提问**

通过引导式对话，帮助用户将模糊想法转化为结构化需求，并**自动记录**有价值的设计决策到记忆库。

**核心原则**：
- 有疑惑就访谈，不猜测用户意图
- 每次给 2-3 个选项 + 推荐
- 整个过程保持确认
- **聊天结束自动记录到记忆库**

---

## 引导工具：question

**必须使用 `question` 工具进行引导式提问**，而非文本形式的选项列表。

### 工具调用格式

```json
{
  "questions": [
    {
      "header": "简短标签（最多30字符）",
      "question": "完整的提问内容？",
      "multiple": false,
      "options": [
        { "label": "选项1 (推荐)", "description": "选项说明" },
        { "label": "选项2", "description": "选项说明" },
        { "label": "选项3", "description": "选项说明" }
      ]
    }
  ]
}
```

### 参数说明

| 参数 | 说明 |
|------|------|
| `header` | 简短标签，用于界面显示，最多30字符 |
| `question` | 完整的提问内容 |
| `multiple` | 是否允许多选，默认 `false` |
| `options` | 选项数组，2-4个最佳 |
| `label` | 选项显示文本（1-5词） |
| `description` | 选项简要说明 |

### 推荐选项标注

在 `label` 中添加 `(推荐)` 后缀标注推荐选项：

```json
{ "label": "动态计算 (推荐)", "description": "根据宗门等级/规模决定" }
```

### 多选场景

当需要用户选择多个选项时：

```json
{
  "questions": [
    {
      "header": "招募来源",
      "question": "请问招募来源有哪些方式？",
      "multiple": true,
      "options": [
        { "label": "凡人招募", "description": "从凡人世界招募" },
        { "label": "散修投奔", "description": "吸引散修加入" },
        { "label": "宗门挖角", "description": "其他宗门弟子转投" }
      ]
    }
  ]
}
```

### 完整示例

**开场引导**：

```json
{
  "questions": [
    {
      "header": "需求类型",
      "question": "您好！我可以帮您梳理需求。请问您想讨论哪类需求？",
      "multiple": false,
      "options": [
        { "label": "功能需求", "description": "开发新功能" },
        { "label": "改进需求", "description": "优化现有功能" },
        { "label": "修复需求", "description": "解决问题或 Bug" },
        { "label": "设计讨论", "description": "游戏设计/机制/系统" },
        { "label": "技能需求", "description": "创建或更新技能" }
      ]
    }
  ]
}
```

**深入引导**：

```json
{
  "questions": [
    {
      "header": "角色方向",
      "question": "角色系统，好的。请问您想先从哪个方向开始？建议从招募开始，因为招募是入口。",
      "multiple": false,
      "options": [
        { "label": "招募 (推荐)", "description": "如何获得弟子" },
        { "label": "培养", "description": "如何提升弟子" },
        { "label": "管理", "description": "如何组织弟子" }
      ]
    }
  ]
}
```

**确认环节**：

```json
{
  "questions": [
    {
      "header": "需求确认",
      "question": "请问理解正确吗？确认后我将输出需求文档并记录到记忆库。",
      "multiple": false,
      "options": [
        { "label": "确认正确", "description": "理解正确，输出文档" },
        { "label": "需要调整", "description": "需要修改或补充" }
      ]
    }
  ]
}
```

### 用户自定义输入

`question` 工具会自动添加"Type your own answer"选项，允许用户输入自定义内容。**无需额外处理**。

---

## 工作流程

```
Step 1: 开场引导 → 定位需求类型
Step 2: 灵活深入 → 按需访谈 + 分支处理
Step 3: 确认理解 → 复述确认
Step 4: 输出文档 → 匹配模板类型
Step 5: 记忆库记录 → 自动提取并存储
```

---

## Step 1: 开场引导

**目标**：快速定位需求类型，匹配后续流程

**question 调用**：
```json
{
  "questions": [{
    "header": "需求类型",
    "question": "您好！我可以帮您梳理需求。请问您想讨论哪类需求？",
    "multiple": false,
    "options": [
      { "label": "功能需求", "description": "开发新功能" },
      { "label": "改进需求", "description": "优化现有功能" },
      { "label": "修复需求", "description": "解决问题或 Bug" },
      { "label": "设计讨论", "description": "游戏设计/机制/系统" },
      { "label": "技能需求", "description": "创建或更新技能" }
    ]
  }]
}
```

**分支处理**：根据用户选择进入对应流程

---

## Step 2: 灵活深入

**目标**：通过引导式选择逐步细化需求

**核心原则**：
- **有疑惑就访谈**：不确定的点必须提问
- **引导式选择**：每次 2-3 个选项 + 推荐
- **及时确认**：关键节点复述确认

**深入维度**（按需选择）：
1. 模块归属
2. 核心体验
3. 用户角色
4. 触发场景
5. 边界范围
6. 技术约束

**question 调用模板**：
```json
{
  "questions": [{
    "header": "[维度名称]",
    "question": "[复述用户选择]。请问 [下一维度]？建议 [选项]，因为 [理由]。",
    "multiple": false,
    "options": [
      { "label": "[选项1] (推荐)", "description": "[简要说明]" },
      { "label": "[选项2]", "description": "[简要说明]" },
      { "label": "[选项3]", "description": "[简要说明]" }
    ]
  }]
}
```

---

## Step 3: 确认理解

**目标**：确保理解正确

**确认方式**：先用表格形式复述核心需求，再调用 question 确认

**确认示例**：
```
让我确认一下您的需求：

[用表格复述核心需求]

| 维度 | 决策 |
|------|------|
| xxx | xxx |
| xxx | xxx |
```

**question 调用**：
```json
{
  "questions": [{
    "header": "需求确认",
    "question": "请问理解正确吗？需要补充或修改吗？",
    "multiple": false,
    "options": [
      { "label": "确认正确", "description": "理解正确，继续" },
      { "label": "需要调整", "description": "需要修改或补充" }
    ]
  }]
}
```

---

## Step 4: 输出文档

**目标**：根据需求类型匹配对应模板

**触发条件**：用户确认理解正确

---

## Step 5: 记忆库记录（自动）

**触发条件**：聊天结束 / 设计决策确认 / 用户偏好明确

### 自动提取规则

| 聊天内容类型 | 记忆分类 | 示例 |
|-------------|---------|------|
| 设计决策（"我们决定..."） | conventions | 弟子晋升采用任务制 |
| 解决方案（"怎么实现..."） | solutions | 灵石通过灵脉产出 |
| 用户偏好（"我喜欢..."） | preferences | 我喜欢简洁的 UI |
| 踩坑教训（"之前..."） | lessons | 之前在 Query 中修改实体出错了 |
| 系统设计（"XX系统..."） | solutions | 战斗系统设计 |

### 自动记录流程

```
1. 检测聊天中的关键决策点
2. 提取：标题、背景、决策内容、标签
3. 自动分类
4. 搜索相似记忆，建立关联
5. 写入 docs/memory-bank/{分类}/
6. 更新 _stats.json
7. git commit
8. 简短提示："已记录: [标题]"
```

### 记录示例

**聊天内容**：
> "我们决定外门弟子晋升采用任务制，通过完成任务积累贡献，达到阈值后自动晋升"

**自动生成记忆**：
```markdown
## 外门弟子晋升机制-任务制

> 创建时间: 2026-02-23
> 分类: conventions
> 状态: active
> 标签: #角色系统 #晋升 #任务

**问题/背景**:
外门弟子如何从资源型角色晋升为 AI 控制角色。

**解决方案/内容**:
任务选拔制：通过完成任务积累贡献，达到阈值后自动晋升为内门弟子。

**关联记忆**: #conventions:弟子晋升选拔机制
```

---

## 需求模板

### 功能需求模板

```markdown
# 功能需求：[需求名称]

## 基本信息
- 状态：草稿
- 优先级：P0/P1/P2
- 模块：[所属模块]

## 需求描述
[一句话描述核心需求]

## 用户故事
作为 [角色]，我希望 [行为]，以便 [收益]。

## 功能要点
- [ ] 要点1
- [ ] 要点2

## 验收标准
- [ ] 标准1
- [ ] 标准2

## 待确认
- [ ] 问题1
```

### 设计讨论模板

```markdown
# 设计讨论：[主题]

## 基本信息
- 状态：草稿
- 涉及系统：[系统列表]

## 问题描述
[要解决什么问题]

## 讨论要点
- [ ] 要点1
- [ ] 要点2

## 决策结论
- 决策1：[结论]
- 决策2：[结论]

## 待确认
- [ ] 问题1

## 关联记忆
- #conventions:xxx
- #solutions:xxx
```

---

## 引导场景

### 场景一：需求评审

**触发**：用户已有需求文档，需要评审

**question 调用**：
```json
{
  "questions": [{
    "header": "评审维度",
    "question": "好的，我来帮您评审需求。请问您希望评审哪些方面？建议先确保需求完整。",
    "multiple": false,
    "options": [
      { "label": "完整性 (推荐)", "description": "检查是否有遗漏" },
      { "label": "可行性", "description": "评估技术实现难度" },
      { "label": "优先级", "description": "确认开发顺序" }
    ]
  }]
}
```

### 场景二：需求拆分

**触发**：需求过于庞大，需要拆分

**question 调用**：
```json
{
  "questions": [{
    "header": "拆分方式",
    "question": "这个需求涉及多个系统。请问您希望如何拆分？建议按阶段拆分可以更快看到成果。",
    "multiple": false,
    "options": [
      { "label": "按模块拆分", "description": "按功能模块划分" },
      { "label": "按阶段拆分 (推荐)", "description": "MVP → 完整版 → 增强版" },
      { "label": "按优先级拆分", "description": "核心功能 → 辅助功能" }
    ]
  }]
}
```

### 场景三：游戏设计讨论

**触发**：用户想讨论游戏机制

**question 调用**：
```json
{
  "questions": [{
    "header": "讨论系统",
    "question": "好的，我们来讨论游戏设计。请问您想讨论哪个系统？",
    "multiple": false,
    "options": [
      { "label": "角色系统", "description": "弟子/掌门/长老" },
      { "label": "经济系统", "description": "灵石/贡献点" },
      { "label": "战斗系统", "description": "战斗机制" },
      { "label": "功法系统", "description": "功法/技能" },
      { "label": "设施系统", "description": "建筑/设施" }
    ]
  }]
}
```

### 场景四：用户想法模糊

**question 调用**：
```json
{
  "questions": [{
    "header": "角色方向",
    "question": "弟子管理，好的。请问您想先从哪个方向开始？建议从招募开始，因为招募是入口。",
    "multiple": false,
    "options": [
      { "label": "招募 (推荐)", "description": "如何获得弟子" },
      { "label": "培养", "description": "如何提升弟子" },
      { "label": "管理", "description": "如何组织弟子" }
    ]
  }]
}
```

### 场景五：需求冲突

**question 调用**：
```json
{
  "questions": [{
    "header": "体验倾向",
    "question": "我注意到一个潜在冲突：您希望弟子有自主决策能力，同时希望玩家能精确控制弟子行为。请问您更倾向于哪种体验？建议混合模式可以兼顾两者。",
    "multiple": false,
    "options": [
      { "label": "玩家主导", "description": "玩家决策，弟子执行" },
      { "label": "弟子自主", "description": "弟子决策，玩家引导" },
      { "label": "混合模式 (推荐)", "description": "关键决策玩家定，日常行为弟子自主" }
    ]
  }]
}
```

### 场景六：需求频繁变更

**question 调用**：
```json
{
  "questions": [{
    "header": "变更处理",
    "question": "明白。这个变更会影响弟子数据结构、UI界面、已规划的招募系统。请问您希望如何处理？建议作为Phase 2避免影响当前进度。",
    "multiple": false,
    "options": [
      { "label": "立即变更", "description": "更新当前需求" },
      { "label": "作为 Phase 2 (推荐)", "description": "先保留原方案" },
      { "label": "替代方案", "description": "找一个折中方案" }
    ]
  }]
}
```

---

## 记忆库集成细节

### 实时检测关键词

| 关键词 | 动作 |
|--------|------|
| "我们决定" / "就定这个" / "采用" | → conventions |
| "怎么解决" / "方案是" / "实现方式" | → solutions |
| "我喜欢" / "偏好" / "不要" | → preferences |
| "之前" / "踩坑" / "错误" / "bug" | → lessons |
| "XX系统设计" / "机制是" | → solutions |

### 聊天结束自动汇总

```
1. 扫描本次聊天的所有决策点
2. 去重（检查记忆库是否已存在）
3. 批量创建记忆
4. 建立关联关系
5. 输出汇总：
   "本次聊天已记录 3 条记忆：
    - conventions:外门弟子晋升机制
    - solutions:灵石产出方案
    - conventions:弟子层级职责"
```

---

## 引导式选择指南

### 选项设计原则

| 原则 | 说明 |
|------|------|
| 数量适中 | 2-3 个最佳，最多 4 个 |
| 互斥性 | 选项之间不重叠 |
| 完整性 | 覆盖主要可能性 |
| 具体性 | 避免抽象描述 |
| 推荐性 | 标注推荐选项并说明理由 |

### 访谈时机

| 情况 | 行动 |
|------|------|
| 不确定用户意图 | 立即提问确认 |
| 存在多种方案 | 给出选项让用户选择 |
| 发现潜在冲突 | 指出并引导解决 |
| 需求范围过大 | 建议拆分或分期 |

---

## 输出规范

### 文档命名

```
docs/requirements/[需求名称]_需求方案.md
docs/design/[主题]_设计讨论.md
```

### 需求状态

| 状态 | 说明 |
|------|------|
| 草稿 | 初步整理 |
| 已确认 | 用户确认 |
| 已实现 | 开发完成 |

### 优先级

| 优先级 | 说明 |
|--------|------|
| P0 | MVP 核心 |
| P1 | 第一版应有 |
| P2 | 后续版本 |

---

## 注意事项

1. **有疑惑就访谈**：不确定的点必须提问，不猜测用户意图
2. **每次 2-3 个选项**：避免信息过载，减少思考负担
3. **给出推荐**：标注推荐选项并说明理由
4. **保持开放**：始终允许用户"其他"或直接描述
5. **及时确认**：关键节点复述确认，避免理解偏差
6. **控制范围**：需求过大时主动建议拆分
7. **自动记录**：聊天结束自动记录有价值内容到记忆库
